<!doctype html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: April 12, 2025 --><html lang="en-us" dir="ltr"
      data-wc-theme-default="auto">
  
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="generator" content="Hugo Blox Builder 0.3.1" />

  
  












  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Francis L. Huang" />

  
  
  
    
  
  <meta name="description" content="Notes to self (and anyone else who might find this useful). With the general linear mixed models (to simplify, I am just omitting super/subscripts):
$$Y = X\beta &#43; Zu &#43; e$$ where we assume $u \sim MVN(0, G)$ and $e \sim MVN(0, R)$. $V$ is:
" />

  
  <link rel="alternate" hreflang="en-us" href="http://localhost:1313/post/extracting-v-matrix/" />

  
  
  
  
    
    <link rel="stylesheet" href="/css/themes/blue.min.css" />
  

  
  
    
    <link href="/dist/wc.min.css" rel="stylesheet" />
  

  
  
  

  

  <script>
     
    window.hbb = {
       defaultTheme: document.documentElement.dataset.wcThemeDefault,
       setDarkTheme: () => {
        document.documentElement.classList.add("dark");
        document.documentElement.style.colorScheme = "dark";
      },
       setLightTheme: () => {
        document.documentElement.classList.remove("dark");
        document.documentElement.style.colorScheme = "light";
      }
    }

    console.debug(`Default Hugo Blox Builder theme is ${window.hbb.defaultTheme}`);

    if ("wc-color-theme" in localStorage) {
      localStorage.getItem("wc-color-theme") === "dark" ? window.hbb.setDarkTheme() : window.hbb.setLightTheme();
    } else {
      window.hbb.defaultTheme === "dark" ? window.hbb.setDarkTheme() : window.hbb.setLightTheme();
      if (window.hbb.defaultTheme === "system") {
        window.matchMedia("(prefers-color-scheme: dark)").matches ? window.hbb.setDarkTheme() : window.hbb.setLightTheme();
      }
    }
  </script>

  <script>
    
    document.addEventListener('DOMContentLoaded', function () {
      
      let checkboxes = document.querySelectorAll('li input[type=\'checkbox\'][disabled]');
      checkboxes.forEach(e => {
        e.parentElement.parentElement.classList.add('task-list');
      });

      
      const liNodes = document.querySelectorAll('.task-list li');
      liNodes.forEach(nodes => {
        let textNodes = Array.from(nodes.childNodes).filter(node => node.nodeType === 3 && node.textContent.trim().length > 1);
        if (textNodes.length > 0) {
          const span = document.createElement('label');
          textNodes[0].after(span);  
          span.appendChild(nodes.querySelector('input[type=\'checkbox\']'));
          span.appendChild(textNodes[0]);
        }
      });
    });
  </script>

  
  
  




































  
  

  
  <link rel="icon" type="image/png" href="/media/icon_hu_3a05525e284cb133.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu_f701646b16bb8941.png" />

  <link rel="canonical" href="http://localhost:1313/post/extracting-v-matrix/" />

  
  
  
  
  
  
  
  
    
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@flhuang" />
    <meta property="twitter:creator" content="@flhuang" />
  
  <meta property="og:site_name" content="FLH Website" />
  <meta property="og:url" content="http://localhost:1313/post/extracting-v-matrix/" />
  <meta property="og:title" content="Extracting the V matrix for MLMs | FLH Website" />
  <meta property="og:description" content="Notes to self (and anyone else who might find this useful). With the general linear mixed models (to simplify, I am just omitting super/subscripts):
$$Y = X\beta &#43; Zu &#43; e$$
where we assume $u \sim MVN(0, G)$ and $e \sim MVN(0, R)$. $V$ is:" /><meta property="og:image" content="http://localhost:1313/media/icon_hu_7c4bcaa7031a3f50.png" />
    <meta property="twitter:image" content="http://localhost:1313/media/icon_hu_7c4bcaa7031a3f50.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-06-18T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-06-18T00:00:00&#43;00:00">
  

  



  


  <title>Extracting the V matrix for MLMs | FLH Website</title>

  
  
  
  
  
    
    
  
  
  <style>
    @font-face {
      font-family: 'Inter var';
      font-style: normal;
      font-weight: 100 900;
      font-display: swap;
      src: url(/dist/font/Inter.var.woff2) format(woff2);
    }
  </style>

  

  
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
      
      
    
      
      
        
        
          
        
          
        
          
        
          
        
          
        
        
        
      
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  







<link type="text/css" rel="stylesheet" href="/dist/pagefind/pagefind-ui.be766eb419317a14ec769d216e9779bfe8f3737c80e780f4ba0dafb57a41a482.css" integrity="sha256-vnZutBkxehTsdp0hbpd5v&#43;jzc3yA54D0ug2vtXpBpII=" />


<script src="/dist/pagefind/pagefind-ui.87693d7c6f2b3b347ce359d0ede762c033419f0a32b22ce508c335a81d841f1b.js" integrity="sha256-h2k9fG8rOzR841nQ7ediwDNBnwoysizlCMM1qB2EHxs="></script>


<script>window.hbb.pagefind = {"baseUrl":"/"};</script>

<style>
  html.dark {
    --pagefind-ui-primary: #eeeeee;
    --pagefind-ui-text: #eeeeee;
    --pagefind-ui-background: #152028;
    --pagefind-ui-border: #152028;
    --pagefind-ui-tag: #152028;
  }
</style>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    new PagefindUI({
      element: "#search",
      showSubResults: true,
      baseUrl: window.hbb.pagefind.baseUrl,
      bundlePath: window.hbb.pagefind.baseUrl + "pagefind/",
    });
  });
  document.addEventListener('DOMContentLoaded', () => {
    let element = document.getElementById('search');
    let trigger = document.getElementById('search_toggle');

    if (trigger) {
      trigger.addEventListener('click', () => {
        element.classList.toggle('hidden');
        element.querySelector("input").value = ""
        element.querySelector("input").focus()

        if (!element.classList.contains('hidden')) {
          let clear_trigger = document.querySelector('.pagefind-ui__search-clear');

          if (clear_trigger && !clear_trigger.hasAttribute('listenerOnClick')) {
            clear_trigger.setAttribute('listenerOnClick', 'true');

            clear_trigger.addEventListener('click', () => {
              element.classList.toggle('hidden');
            });
          }
        }

      });
    }
  });
</script>










  
  
  <link type="text/css" rel="stylesheet" href="/dist/lib/katex/katex.min.505d5f829022bb7b4f24dfee0aa1141cd7bba67afe411d1240335f820960b5c3.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr&#43;QR0SQDNfgglgtcM=" />
  
  
  <script defer src="/dist/lib/katex/katex.min.dc84b296ec3e884de093158f760fd9d45b6c7abe58b5381557f4e138f46a58ae.js" integrity="sha256-3ISyluw&#43;iE3gkxWPdg/Z1Ftser5YtTgVV/ThOPRqWK4="></script>
  
  
  
  
  <script defer src="/js/katex-renderer.6579ec9683211cfb952064aedf3a3baea5eeb17a061775b32b70917474637c80.js" integrity="sha256-ZXnsloMhHPuVIGSu3zo7rqXusXoGF3WzK3CRdHRjfIA="></script>
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  






  
  
  
  
  
  
  
  <script
    defer
    src="/js/hugo-blox-en.min.js"
    integrity=""
  ></script>

  
  








  
    
      
      <script async defer src="https://buttons.github.io/buttons.js"></script>

      
    
  




</head>

  <body class="dark:bg-hb-dark dark:text-white page-wrapper" id="top">
    <div id="page-bg"></div>
    <div class="page-header sticky top-0 z-30">
      
      
      
        
        
        
          <header id="site-header" class="header">
  <nav class="navbar px-3 flex justify-left">
    <div class="order-0 h-100">
      
      <a class="navbar-brand" href="/" title="FLH Website">
        Francis L. Huang
      </a>
    </div>
    
    <input id="nav-toggle" type="checkbox" class="hidden" />
    <label
      for="nav-toggle"
      class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1">
      <svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20">
        <title>Open Menu</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
      <svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20">
        <title>Close Menu</title>
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    

    
    
    <ul
      id="nav-menu"
      class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8 justify-left
      ">
      
      
      
      
      
      
      <li class="nav-item">
        <a
          class="nav-link "
          
          href="/#talks"
        >Talks</a
        >
      </li>
      
      
      
      
      
      
      <li class="nav-item">
        <a
          class="nav-link "
          
          href="/#news"
        >Posts</a
        >
      </li>
      
      
      
      
      
      
      <li class="nav-item">
        <a
          class="nav-link "
          
          href="/MLMusingR/"
        >MLMusingR</a
        >
      </li>
      
      
      
      
      
      
      <li class="nav-item">
        <a
          class="nav-link "
          
          href="/projects/"
        >Projects</a
        >
      </li>
      
      
      
      
      
      
      <li class="nav-item">
        <a
          class="nav-link "
          
          href="/teaching/"
        >Teaching</a
        >
      </li>
      
      
      
      
      
      
      <li class="nav-item">
        <a
          class="nav-link "
          
          href="/service/"
        >Service</a
        >
      </li>
      
      
      
      
      
      
      <li class="nav-item nav-dropdown group relative">
            <span
              class="nav-link 
                
                
                
              
                
                
                
               inline-flex items-center">
              Research
              <svg class="h-4 w-4 fill-current inline-block" viewBox="0 0 20 20">
                <path
                  d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
              </svg>
            </span>
        <ul
          class="nav-dropdown-list lg:group-hover:visible lg:group-hover:opacity-100">
          
          
          
          <li class="nav-dropdown-item">
            <a
              class="nav-dropdown-link "
              
              href="/#papers">
              Papers
            </a>
          </li>
          
          
          
          <li class="nav-dropdown-item">
            <a
              class="nav-dropdown-link "
              
              href="/r">
              R Packages
            </a>
          </li>
          
        </ul>
      </li>
      
      
      
    </ul>

    <div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0">

      
      
      
      <button
        aria-label="search"
        class="text-black hover:text-primary  inline-block px-3 text-xl dark:text-white"
        id="search_toggle">
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512" fill="currentColor"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
      </button>
      

      
      
      <div class="px-3 text-black hover:text-primary-700 dark:text-white dark:hover:text-primary-300
            [&.active]:font-bold [&.active]:text-black/90 dark:[&.active]:text-white">
        <button class="theme-toggle mt-1" accesskey="t" title="appearance">
          <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" class="dark:hidden">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" class=" dark:block [&:not(dark)]:hidden">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
      </div>
      

      
      

      
      
    </div>
  </nav>
</header>


<div id="search" class="hidden p-3"></div>


        
      
    </div>
    <div class="page-body  my-10">
      





<div class="mx-auto flex max-w-screen-xl">
  



<aside class="hb-sidebar-container max-lg:[transform:translate3d(0,-100%,0)] lg:hidden xl:block">
  
  <div class="px-4 pt-4 lg:hidden">
    
    
  </div>
  <div class="hb-scrollbar lg:h-[calc(100vh-var(--navbar-height))]">
    <ul class="flex flex-col gap-1 lg:hidden">
      
      
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/"
    
  >Publications
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2025/lsa-weights/"
    
  >Reassessing weights in large-scale assessments and multilevel models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2025/cornell-behavioral-2025/"
    
  >Behavioral threat assessment and equity in exclusionary school discipline
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2025/huang-cluster-robust-2025/"
    
  >Cluster-robust standard errors with three-level data
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2025/cornell-referral-2025/"
    
  >Referral rates for school threat assessment
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/gregory-restorative-2025/"
    
  >Restorative justice conferences in elementary and secondary schools
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/jimerson-advancing-2024/"
    
  >Advancing diversity, equity, and inclusion in school psychology science and scholarship: Changing training and practice in the field of school psychology
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/chuang-potential-2022/"
    
  >Potential moderation across racial groups in perceptions of authoritative school climate and peer victimization and student engagement
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/huang-seasonality-2023/"
    
  >The seasonality of school climate
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/smith-school-2024/"
    
  >School bullying and gender minority youth: Victimization experiences and perceived prevalence
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/reinke-having-2024/"
    
  >Having a trusted adult in school: Concurrent and predictive relations with internalizing problems across development
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/eddy-positive-2024/"
    
  >Positive student-teacher relationships and exclusionary discipline practices
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/gregory-steadfast-2023/"
    
  >Steadfast implementation of restorative practices during the Covid-19 pandemic: A case study of consultancy and leadership in an elementary school
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/huang-replication-2024/"
    
  >Replication studies using secondary or nonexperimental datasets
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/huang-using-2024/"
    
  >Using plausible values when fitting multilevel models with large-scale assessment data using R
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/gregory-adolescent-2024/"
    
  >Adolescent exposure to restorative practices and their perceptions of support, structure, and bullying in the school climate
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2025/stemmler-investigating-2024/"
    
  >Investigating the use of robust standard errors to account for two-way clustering in cross-classified data structures
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/huang-impact-2023/"
    
  >The impact of restorative practices on the use of out-of-school suspensions: Results from a cluster randomized controlled trial
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/woods-relationship-2023/"
    
  >The relationship between teacher stress and job satisfaction as moderated by coping
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/herman-usability-2023/"
    
  >Usability and social consequences of the early identification system as a universal screener for social, emotional, and behavioral risks.
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/huang-accounting-2023/"
    
  >Accounting for heteroskedasticity resulting from between-group differences in multilevel models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/wiedermann-advanced-2023/"
    
  >Advanced categorical data analysis in prevention science
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/cohen-school-2023/"
    
  >In-school and out-of-school suspension: Behavioral and psychological outcomes in a predominately black sample of middle school students
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/book/huang-practical-2023/"
    
  >Practical multilevel modeling using R
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/maeng-teacher-2023/"
    
  >Teacher Perceptions of School Resource Officers and Associations with School Safety
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/huang-using-2023/"
    
  >Using robust standard errors for the analysis of binary outcomes with a small number of clusters
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/gregory-evaluation-2022/"
    
  >Evaluation of the whole school restorative practices project: One-year impact on discipline incidents
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/olsen-interaction-2022/"
    
  >Interaction of socioeconomic status and class relations on reading
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/crichlow-ball-student-2022/"
    
  >Student perceptions of school resource officers and threat reporting
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/reinke-examining-2022/"
    
  >Examining the validity of the Early Identification System – Student Version for screening in an elementary school sample
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/huang-alternatives-2022/"
    
  >Alternatives to logistic regression models in experimental studies
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/huang-analyzing-2022/"
    
  >Analyzing cross-sectionally clustered data using generalized estimating equations
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/eddy-evaluation-2022/"
    
  >Evaluation of a bibliotherapy-based stress intervention for teachers
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/huang-using-2022/"
    
  >Using cluster-robust standard errors when analyzing group-randomized trials with few clusters
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/herman-individual-2021/"
    
  >Individual and school predictors of teacher stress, coping, and wellness during the COVID-19 pandemic
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/olsen-association-2021/"
    
  >The association between student socioeconomic status and student–teacher relationships on math achievement
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/huang-does-2021/"
    
  >Does worrying matter? Priming and attitudes towards mask wearing in a midwestern state
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/stohlman-high-2021/"
    
  >High school graduation outcomes of student threat assessment
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test3/jimerson-advancing-2021/"
    
  >Advancing diversity, equity, and inclusion in school psychology: Be the change
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2022/herman-investigation-2021/"
    
  >An investigation of the psychometric properties of the Early Identification System–student report in a middle school sample
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2020/huang-authoritative-2021/"
    
  >Authoritative school climate and out-of-school suspensions: Results from a nationally-representative survey of 10th grade students
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2020/thompson-confirmatory-2021/"
    
  >Confirmatory factor structure and predictive validity of the Early Identification System—Student Report in a community sample of high school students
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/huang-teacher-2021/"
    
  >Teacher support for zero tolerance is associated with higher suspension rates and lower feelings of safety
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/maeng-student-2020/"
    
  >Student threat assessment as an alternative to exclusionary discipline
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/jiv/huang-role-2017/"
    
  >The role of the perceptions of school climate and teacher victimization by students
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2020/eddy-does-2020/"
    
  >Does teacher emotional exhaustion and efficacy predict student discipline sanctions?
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/huang-prior-2020/"
    
  >Prior problem behaviors do not account for the racial suspension gap
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2020/huang-manova-2020/"
    
  >MANOVA: A procedure whose time has passed?
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2020/huang-relationship-2020/"
    
  >The relationship between school disciplinary resolutions with school climate and attitudes toward school
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/prewett-student-2019/"
    
  >Student and teacher perceptions on student-teacher relationship quality: A middle school perspective
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2019/huang-investigation-2019/"
    
  >An investigation of the psychometric properties of the Early Identification System–Student Report
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/huang-school-2019/"
    
  >School teasing and bullying after the presidential election
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/burnette-school-2019/"
    
  >School threat assessment versus suicide assessment: Statewide prevalence and case characteristics
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/olsen-teacher-2019/"
    
  >Teacher job satisfaction by principal support and teacher cooperation: Results from the Schools and Staffing Survey
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2019/smith-understanding-2019/"
    
  >Understanding family–school engagement across and within elementary- and middle-school contexts
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-multilevel-2018-1/"
    
  >Multilevel modeling myths
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-relationship-2018/"
    
  >The relationship of school climate with out-of-school suspensions
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/ford-effect-2018/"
    
  >The effect of orthographic complexity on Spanish spelling in Grades 1–3
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/gregory-examination-2018/"
    
  >An examination of restorative interventions and racial equity in out-of-school suspensions
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-bullying-2018/"
    
  >Bullying involvement, teacher-student relationships, and psychosocial outcomes
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-black-2018/"
    
  >Do Black students misbehave more? Investigating the differential involvement hypothesis and out-of-school suspensions
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-multilevel-2018/"
    
  >Multilevel modeling and ordinary least squares regression:  How comparable are they?
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/cornell-racialethnic-2018/"
    
  >Racial/ethnic parity in disciplinary consequences using student threat assessment
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/jia-impact-2018/"
    
  >The impact of validity screening on associations between self-reports of bullying victimization and student outcomes
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-using-2018-1/"
    
  >Using cluster bootstrapping to analyze nested data with a few clusters
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-using-2018/"
    
  >Using instrumental variable estimation to evaluate randomized experiments with imperfect compliance
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/bullying/datta-toxicity-2017/"
    
  >The toxicity of bullying by teachers and other school staff
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/cornell-student-2017/"
    
  >Student Threat Assessment as a Standard School Safety Practice: Results From a Statewide Implementation Study.
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/cornell-student-2017/"
    
  >Student Threat Assessment as a Standard School Safety Practice: Results From a Statewide Implementation Study.
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/huang-student-2017/"
    
  >Student attitudes and behaviors as explanations for the Black-White suspension gap
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/konold-racialethnic-2017/"
    
  >Racial/ethnic differences in perceptions of school climate and its association with student engagement and peer aggression
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/huang-question-2016/"
    
  >Question order affects the measurement of bullying victimization among middle school students
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/bullying/datta-aggressive-2016/"
    
  >Aggressive attitudes and prevalence of bullying bystander behavior in middle school
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/bullying/millspaugh-prevalence-2015/"
    
  >Prevalence of aggressive attitudes and willingness to report threats in middle school
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/cornell-school-2015/"
    
  >School counselor use of peer nominations to identify victims of bullying
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/rubie-davies-successive-2014/"
    
  >Successive teacher expectation effects across the early school years
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/gregory-it-2013/"
    
  >It takes a village: The effects of 10th grade college-going expectations of students, parents, and teachers four years later
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/test2/huang-differential-2012/"
    
  >The differential effects of preschool: Evidence from Virginia
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-is-2009/"
    
  >Is experience the best teacher? A multilevel analysis of teacher characteristics and student achievement in low performing schools
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/publication/journal-article/2018/huang-corruption-2008/"
    
  >Corruption and educational outcomes: Two steps forward, one step back
    </a>
              
            </li></ul>
      </div></li>
        <li class="open"><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/"
    
  >Posts
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/weights_2025/"
    
  >Weights with Multilevel Models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/jobs-2025/"
    
  >🎉 Job postings 2024-2025
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/pca-image/"
    
  >Fun with PCA using Images
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/2024_lsa/"
    
  >Selecting the proper weights in LSAs with multilevel models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/pv3/"
    
  >Using Plausible Values with Multilevel Models Using R (update)
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/pv/"
    
  >Using Plausible Values with Multilevel Models Using R
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/jobs-2024/"
    
  >🎉 Job postings 2023-2024
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/gd_example/"
    
  >Gradient descent example 1
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/logreg_matrix/"
    
  >🖩 Logistic regression with matrices
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/residuals_mlm/"
    
  >Residuals with Multilevel Models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/jobs-2023/"
    
  >🎉 Job postings 2022-2023
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/residuals/"
    
  >Fun with residuals
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/mi_pt3/"
    
  >Using FIML in R for Multilevel Data
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/2022_cr2/"
    
  >Robust standard errors in mixed models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/logistic-regression-fisher-scoring/"
    
  >Logistic regression from scratch (Newton Raphson and Fisher Scoring)
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/likelihood_2022/"
    
  >Using REML and ML for estimation
    </a>
              
            </li><li class="flex flex-col open"><a
    class="hb-sidebar-custom-link
      sidebar-active-item bg-primary-100 font-semibold text-primary-800 dark:bg-primary-300 dark:text-primary-900"
    href="/post/extracting-v-matrix/"
    
  >Extracting the V matrix for MLMs
    </a>
  
    <ul class="hb-sidebar-mobile-toc"><li>
              <a
                href="#1-manual-method"
                class="hb-docs-link"
              >1. Manual method</a>
            </li>
          <li>
              <a
                href="#2-more-automated-way"
                class="hb-docs-link"
              >2. More automated way:</a>
            </li>
          <li>
              <a
                href="#3-try-it-with-simple-three-level-data"
                class="hb-docs-link"
              >3. Try it with simple three level data&amp;hellip;</a>
            </li>
          <li>
              <a
                href="#4-throw-in-random-slopes"
                class="hb-docs-link"
              >4. Throw in random slopes</a>
            </li>
          </ul>
  
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/gee/"
    
  >🎉 Analyzing clustered data using GEEs
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/ml/"
    
  >🎉 Using maximum likelihood
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/compare/"
    
  >🎉 Comparing coefficients across logistic regression models
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/prior-problem-behavior-and-suspensions-a-replication/"
    
  >Prior problem behavior and suspensions: A replication
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/mdata/"
    
  >🎉 Using FIML and MI in R
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/applied/"
    
  >🎉 Applied example for alternatives to logistic regression
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/pca_2020/"
    
  >🎉 Principal Components Analysis using R
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/centering/"
    
  >🎉 Why does centering reduce multicollinearity?
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/poisson-and-negative-binomial-regression-using-r/"
    
  >Poisson and Negative Binomial Regression using R
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/sim2data/"
    
  >🎉 Simulating two level data
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/2018-06-16-difference-between-variance-covariance-and-correlation-matrix/"
    
  >🧠 Difference between correlation and covariance matrices
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/iv2/2018-08-17-instrumental-variables-within-a-sem-framework/"
    
  >Instrumental variables within an SEM framework
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/se/"
    
  >🎉 Class Example- Standard Errors Too Small
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/iv/"
    
  >🎉 Understanding instrumental variables
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/post/ovb/"
    
  >Omitted Variable Bias (OVB) Example
    </a>
              
            </li></ul>
      </div></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/mlmusingr/"
    
  >
    </a></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/r/"
    
  >
    </a></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/service/"
    
  >
    </a></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/project/"
    
  >Projects
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/project/uva/"
    
  >Youth Violence Project @ UVA
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/project/av/"
    
  >MO Prison Transformation Project
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/project/mpsi/"
    
  >Missouri Prevention Science Institute
    </a>
              
            </li></ul>
      </div></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/projects/"
    
  >Projects
    </a></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/event/"
    
  >Recent &amp; Upcoming Talks
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/event/example/"
    
  >Replication studies using secondary and nonexperimental datasets
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/event/mlm_ph/"
    
  >Multilevel Modeling with Large-Scale International Databases Using HLM (Philadelphia)
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/event/korea_23/"
    
  >Using cluster robust standard errors to analyze nested data with a few clusters (Korea)
    </a>
              
            </li></ul>
      </div></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/teaching/"
    
  >Teaching
        <span data-hb-sidebar-toggle>
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-[18px] min-w-[18px] rounded-sm p-0.5 hover:bg-gray-800/5 dark:hover:bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="origin-center transition-transform rtl:-rotate-180"></path></svg>
        </span>
    </a><div class="ltr:pr-0 overflow-hidden">
        <ul class="hb-sidebar-list"><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/teaching/dm/"
    
  >Data Management (using R)
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/teaching/mcsim/"
    
  >Monte Carlo Simulation
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/teaching/mlm/"
    
  >Multilevel Modeling
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/teaching/eval/"
    
  >Program Evaluation
    </a>
              
            </li><li class="flex flex-col "><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/teaching/quantfound/"
    
  >Quantitative Foundations
    </a>
              
            </li></ul>
      </div></li>
        <li class=""><a
    class="hb-sidebar-custom-link
      text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-primary-800 dark:hover:text-gray-50"
    href="/experience/"
    
  >Experience
    </a></li>
    </ul>

    <div class="max-xl:hidden h-0 w-64 shrink-0"></div></div>

</aside>
  

<nav class="hb-toc order-last hidden w-64 shrink-0 xl:block print:hidden px-4" aria-label="table of contents">
  











  <div class="hb-scrollbar text-sm [hyphens:auto] sticky top-16 overflow-y-auto pr-4 pt-6 max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] -mr-4 rtl:-ml-4"><p class="mb-4 font-semibold tracking-tight">On this page</p><ul>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#1-manual-method">1. Manual method</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#2-more-automated-way">2. More automated way:</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#3-try-it-with-simple-three-level-data">3. Try it with simple three level data…</a>
      </li>
      <li class="my-2 scroll-my-6 scroll-py-6">
        <a class="font-semibold inline-block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 w-full break-words" href="#4-throw-in-random-slopes">4. Throw in random slopes</a>
      </li></ul>

  
  
    
    
  



    












  </div>
  </nav>


  <article class="w-full break-words flex min-h-[calc(100vh-var(--navbar-height))] min-w-0 justify-center pb-8 pr-[calc(env(safe-area-inset-right)-1.5rem)]">
    <main class="w-full min-w-0 max-w-6xl px-6 pt-4 md:px-12">

      
      <div class="mb-4">
        <div class="mt-1.5 flex items-center gap-1 overflow-hidden text-sm text-gray-500 dark:text-gray-400">
      <div class="whitespace-nowrap transition-colors min-w-[24px] overflow-hidden text-ellipsis hover:text-gray-900 dark:hover:text-gray-100">
        <a href="http://localhost:1313/post/">Posts</a>
      </div><svg class="w-3.5 shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m8.25 4.5l7.5 7.5l-7.5 7.5"/></svg><div class="whitespace-nowrap font-medium text-gray-700 dark:text-gray-100">Extracting the V matrix for MLMs</div>
</div>

      </div>
      

      <h1 class="mt-2 text-4xl font-bold tracking-tight text-slate-900 dark:text-slate-100">Extracting the V matrix for MLMs</h1>

      <div class="mt-4 mb-16">
      <div class="text-gray-500 dark:text-gray-300 text-sm flex items-center flex-wrap gap-y-2"><span class="mr-1">Jun 18, 2021</span>
        

        
        <span class="mx-1">·</span>
        <span class="mx-1">
          7 min read
        </span>
        
        </div>

        <div class="mt-3">
          





        </div>
      </div>



      
      
      

      
      

      <div class="prose prose-slate lg:prose-xl dark:prose-invert">
        <p><em>Notes to self (and anyone else who might find this useful).</em> With the general linear mixed models (to simplify, I am just omitting super/subscripts):</p>
$$Y = X\beta + Zu + e$$<p>
where we assume $u \sim MVN(0, G)$ and $e \sim MVN(0, R)$. $V$ is:</p>
$$V = ZGZ^T + R$$<p>Software estimates $V$ iteratively and maximizes the likelihood (the function of which depends on whether ML or REML is used). The value of $\beta$ can be obtained using:</p>
$$\hat{\beta} = (X^TV^{-1}X)^{-1}X^TV^{-1}y$$<p>.</p>
<p>I just wanted to figure out how to extract $V$ from the R output.</p>
<h2 id="1-manual-method">1. Manual method</h2>
<p>Just using the <code>sleepstudy</code> dataset:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="n">sleepstudy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">nrow</span><span class="p">(</span><span class="n">sleepstudy</span><span class="p">)</span> <span class="c1">#total number of observations</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[1] 180
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dplyr</span><span class="o">::</span><span class="nf">n_distinct</span><span class="p">(</span><span class="n">sleepstudy</span><span class="o">$</span><span class="n">Subject</span><span class="p">)</span> <span class="c1">#number of clusters</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[1] 18
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">m1</span> <span class="o">&lt;-</span> <span class="nf">lmer</span><span class="p">(</span><span class="n">Reaction</span> <span class="o">~</span> <span class="n">Days</span> <span class="o">+</span> <span class="p">(</span><span class="n">Days</span> <span class="o">|</span> <span class="n">Subject</span><span class="p">),</span> <span class="n">sleepstudy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zed" data-lang="zed"><span class="line"><span class="cl"><span class="n">Linear</span><span class="w"> </span><span class="n">mixed</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">REML</span><span class="p">.</span><span class="w"> </span><span class="n">t</span><span class="o">-</span><span class="n">tests</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">Satterthwaite</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lmerModLmerTest</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Formula</span><span class="o">:</span><span class="w"> </span><span class="n">Reaction</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Days</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Days</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Subject</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">sleepstudy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">REML</span><span class="w"> </span><span class="n">criterion</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">convergence</span><span class="o">:</span><span class="w"> </span><span class="err">1744</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Scaled</span><span class="w"> </span><span class="n">residuals</span><span class="o">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">Min</span><span class="w">     </span><span class="err">1</span><span class="n">Q</span><span class="w"> </span><span class="n">Median</span><span class="w">     </span><span class="err">3</span><span class="n">Q</span><span class="w">    </span><span class="n">Max</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="err">3</span><span class="p">.</span><span class="err">954</span><span class="w"> </span><span class="o">-</span><span class="err">0</span><span class="p">.</span><span class="err">463</span><span class="w">  </span><span class="err">0</span><span class="p">.</span><span class="err">023</span><span class="w">  </span><span class="err">0</span><span class="p">.</span><span class="err">463</span><span class="w">  </span><span class="err">5</span><span class="p">.</span><span class="err">179</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Random</span><span class="w"> </span><span class="n">effects</span><span class="o">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Groups</span><span class="w">   </span><span class="n">Name</span><span class="w">        </span><span class="n">Variance</span><span class="w"> </span><span class="n">Std</span><span class="p">.</span><span class="n">Dev</span><span class="p">.</span><span class="w"> </span><span class="n">Corr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Subject</span><span class="w">  </span><span class="p">(</span><span class="n">Intercept</span><span class="p">)</span><span class="w"> </span><span class="err">612</span><span class="p">.</span><span class="err">1</span><span class="w">    </span><span class="err">24</span><span class="p">.</span><span class="err">74</span><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">Days</span><span class="w">         </span><span class="err">35</span><span class="p">.</span><span class="err">1</span><span class="w">     </span><span class="err">5</span><span class="p">.</span><span class="err">92</span><span class="w">    </span><span class="err">0</span><span class="p">.</span><span class="err">07</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Residual</span><span class="w">             </span><span class="err">654</span><span class="p">.</span><span class="err">9</span><span class="w">    </span><span class="err">25</span><span class="p">.</span><span class="err">59</span><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">obs</span><span class="o">:</span><span class="w"> </span><span class="err">180</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="o">:</span><span class="w">  </span><span class="n">Subject</span><span class="p">,</span><span class="w"> </span><span class="err">18</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Fixed</span><span class="w"> </span><span class="n">effects</span><span class="o">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Estimate</span><span class="w"> </span><span class="n">Std</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="w">     </span><span class="n">df</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">Pr</span><span class="p">(</span><span class="o">&gt;|</span><span class="n">t</span><span class="o">|</span><span class="p">)</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">Intercept</span><span class="p">)</span><span class="w">   </span><span class="err">251</span><span class="p">.</span><span class="err">41</span><span class="w">       </span><span class="err">6</span><span class="p">.</span><span class="err">82</span><span class="w">  </span><span class="err">17</span><span class="p">.</span><span class="err">00</span><span class="w">   </span><span class="err">36</span><span class="p">.</span><span class="err">84</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="err">2</span><span class="n">e</span><span class="o">-</span><span class="err">16</span><span class="w"> </span><span class="o">***</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Days</span><span class="w">           </span><span class="err">10</span><span class="p">.</span><span class="err">47</span><span class="w">       </span><span class="err">1</span><span class="p">.</span><span class="err">55</span><span class="w">  </span><span class="err">17</span><span class="p">.</span><span class="err">00</span><span class="w">    </span><span class="err">6</span><span class="p">.</span><span class="err">77</span><span class="w">  </span><span class="err">3</span><span class="p">.</span><span class="err">3</span><span class="n">e</span><span class="o">-</span><span class="err">06</span><span class="w"> </span><span class="o">***</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Signif</span><span class="p">.</span><span class="w"> </span><span class="n">codes</span><span class="o">:</span><span class="w">  </span><span class="err">0</span><span class="w"> </span><span class="err">&#39;</span><span class="o">***</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">001</span><span class="w"> </span><span class="err">&#39;</span><span class="o">**</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">01</span><span class="w"> </span><span class="err">&#39;</span><span class="o">*</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">05</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">1</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="err">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Correlation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Fixed</span><span class="w"> </span><span class="n">Effects</span><span class="o">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">(</span><span class="n">Intr</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Days</span><span class="w"> </span><span class="o">-</span><span class="err">0</span><span class="p">.</span><span class="err">138</span><span class="w">
</span></span></span></code></pre></div><p>To obtain the $V$ matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Z</span> <span class="o">&lt;-</span> <span class="nf">getME</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="s">&#39;Z&#39;</span><span class="p">)</span> <span class="c1">#180 x 36</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span> <span class="o">&lt;-</span> <span class="nf">bdiag</span><span class="p">(</span><span class="nf">VarCorr</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span> <span class="c1">#2 x 2</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span> <span class="c1">#the vcov matrix for RE</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 2 x 2 sparse Matrix of class &#34;dsCMatrix&#34;
</span></span><span class="line"><span class="cl">##             (Intercept) Days
</span></span><span class="line"><span class="cl">## (Intercept)       612.1  9.6
</span></span><span class="line"><span class="cl">## Days                9.6 35.1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">R</span> <span class="o">&lt;-</span> <span class="nf">diag</span><span class="p">(</span><span class="nf">sigma</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="n">^2</span><span class="p">,</span> <span class="nf">nobs</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span> <span class="c1">#180 x 180</span>
</span></span></code></pre></div><p>$G$ is a 2 $\times$ 2 matrix. Need to expand this based on the number of cluster/subjects.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Gm</span> <span class="o">&lt;-</span> <span class="nf">kronecker</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="m">18</span><span class="p">),</span> <span class="n">G</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Gm[1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="n">]</span> <span class="c1">#just to show this</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 6 x 6 sparse Matrix of class &#34;dgCMatrix&#34;
</span></span><span class="line"><span class="cl">##                                      
</span></span><span class="line"><span class="cl">## [1,] 612.1  9.6   .    .     .    .  
</span></span><span class="line"><span class="cl">## [2,]   9.6 35.1   .    .     .    .  
</span></span><span class="line"><span class="cl">## [3,]   .    .   612.1  9.6   .    .  
</span></span><span class="line"><span class="cl">## [4,]   .    .     9.6 35.1   .    .  
</span></span><span class="line"><span class="cl">## [5,]   .    .     .    .   612.1  9.6
</span></span><span class="line"><span class="cl">## [6,]   .    .     .    .     9.6 35.1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">V</span> <span class="o">&lt;-</span> <span class="n">Z</span> <span class="o">%*%</span> <span class="n">Gm</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">+</span> <span class="n">R</span>
</span></span></code></pre></div><p>Knowing $V$, we can put this together to get the fixed effects:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">&lt;-</span> <span class="n">m1</span><span class="o">@</span><span class="n">resp</span><span class="o">$</span><span class="n">y</span>
</span></span></code></pre></div><p>I will just make a function to put this together:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">getFE</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">y</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nf">solve</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">%*%</span> <span class="nf">solve</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">getFE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 2 x 1 Matrix of class &#34;dgeMatrix&#34;
</span></span><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## (Intercept) 251.4
</span></span><span class="line"><span class="cl">## Days         10.5
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">fixef</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="c1">#the same</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## (Intercept)        Days 
</span></span><span class="line"><span class="cl">##       251.4        10.5
</span></span></code></pre></div><p>Doing this way is fine for simple, well arranged (sorted) datasets but can get more complicated with more levels of clustering (three or more levels). I had to create the Gm matrix.</p>
<h2 id="2-more-automated-way">2. More automated way:</h2>
<p>After some Googling, I found <a href="https://stackoverflow.com/questions/45650548/get-residual-variance-covariance-matrix-in-lme4" target="_blank" rel="noopener">this</a> which shows how to make a more general function to construct that $V$ matrix. I just put this into a function which will make it easier to call and should work with more complicated RE specifications:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">getV</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="n">var.d</span> <span class="o">&lt;-</span> <span class="nf">crossprod</span><span class="p">(</span><span class="nf">getME</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#34;Lambdat&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">Zt</span> <span class="o">&lt;-</span> <span class="nf">getME</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#34;Zt&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">vr</span> <span class="o">&lt;-</span> <span class="nf">sigma</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">^2</span>
</span></span><span class="line"><span class="cl">  <span class="n">var.b</span> <span class="o">&lt;-</span> <span class="n">vr</span> <span class="o">*</span> <span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">Zt</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">var.d</span> <span class="o">%*%</span> <span class="n">Zt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">sI</span> <span class="o">&lt;-</span> <span class="n">vr</span> <span class="o">*</span> <span class="n">Matrix</span><span class="o">::</span><span class="nf">Diagonal</span><span class="p">(</span><span class="nf">nobs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1">#for a sparse matrix</span>
</span></span><span class="line"><span class="cl">  <span class="n">var.y</span> <span class="o">&lt;-</span> <span class="n">var.b</span> <span class="o">+</span> <span class="n">sI</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Just using the earlier example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">getFE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="nf">getV</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span> <span class="c1">#works</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 2 x 1 Matrix of class &#34;dgeMatrix&#34;
</span></span><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## (Intercept) 251.4
</span></span><span class="line"><span class="cl">## Days         10.5
</span></span></code></pre></div><h2 id="3-try-it-with-simple-three-level-data">3. Try it with simple three level data&hellip;</h2>
<p>Just make a small dataset that is manageable (always helpful to be able to see the data). Five students with 3 teachers in 10 sch (or 15 students per school)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">n1</span> <span class="o">&lt;-</span> <span class="m">5</span><span class="p">;</span> <span class="n">n2</span> <span class="o">=</span> <span class="m">3</span><span class="p">;</span> <span class="n">n3</span> <span class="o">=</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="n">sch</span> <span class="o">&lt;-</span> <span class="kc">letters</span><span class="n">[1</span><span class="o">:</span><span class="m">10</span><span class="n">]</span> <span class="c1">#schoolid</span>
</span></span><span class="line"><span class="cl"><span class="n">tch</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">30</span> <span class="c1">#teacherid</span>
</span></span><span class="line"><span class="cl"><span class="n">sch.cl</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="n">sch</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span><span class="p">)</span> <span class="c1">#cluster var</span>
</span></span><span class="line"><span class="cl"><span class="n">tch.cl</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="n">tch</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="n">n1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">e3</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n1</span><span class="p">),</span> <span class="n">each</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">e2</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n2</span> <span class="o">*</span> <span class="n">n1</span><span class="p">),</span> <span class="n">each</span> <span class="o">=</span> <span class="n">n1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x1</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">*</span> <span class="n">n3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">e1</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> <span class="o">*</span> <span class="n">n3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">&lt;-</span> <span class="n">e3</span> <span class="o">+</span> <span class="n">e2</span> <span class="o">+</span> <span class="m">.5</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">e1</span>
</span></span><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">sch.cl</span><span class="p">,</span> <span class="n">tch.cl</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">e1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dat[1</span><span class="o">:</span><span class="m">30</span><span class="p">,</span> <span class="n">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">        y sch.cl tch.cl    e3     e2      x1      e1
</span></span><span class="line"><span class="cl">1   0.405      a      1 -0.56  1.715 -1.0678 -0.2154
</span></span><span class="line"><span class="cl">2   1.111      a      1 -0.56  1.715 -0.2180  0.0653
</span></span><span class="line"><span class="cl">3   0.608      a      1 -0.56  1.715 -1.0260 -0.0341
</span></span><span class="line"><span class="cl">4   2.919      a      1 -0.56  1.715 -0.7289  2.1285
</span></span><span class="line"><span class="cl">5   0.101      a      1 -0.56  1.715 -0.6250 -0.7413
</span></span><span class="line"><span class="cl">6  -2.039      a      2 -0.56  0.461 -1.6867 -1.0960
</span></span><span class="line"><span class="cl">7   0.357      a      2 -0.56  0.461  0.8378  0.0378
</span></span><span class="line"><span class="cl">8   0.288      a      2 -0.56  0.461  0.1534  0.3105
</span></span><span class="line"><span class="cl">9  -0.232      a      2 -0.56  0.461 -1.1381  0.4365
</span></span><span class="line"><span class="cl">10  0.069      a      2 -0.56  0.461  1.2538 -0.4584
</span></span><span class="line"><span class="cl">11 -2.676      a      3 -0.56 -1.265  0.4265 -1.0633
</span></span><span class="line"><span class="cl">12 -0.710      a      3 -0.56 -1.265 -0.2951  1.2632
</span></span><span class="line"><span class="cl">13 -1.728      a      3 -0.56 -1.265  0.8951 -0.3497
</span></span><span class="line"><span class="cl">14 -2.252      a      3 -0.56 -1.265  0.8781 -0.8655
</span></span><span class="line"><span class="cl">15 -1.651      a      3 -0.56 -1.265  0.8216 -0.2363
</span></span><span class="line"><span class="cl">16 -0.770      b      4 -0.23 -0.687  0.6886 -0.1972
</span></span><span class="line"><span class="cl">17  0.470      b      4 -0.23 -0.687  0.5539  1.1099
</span></span><span class="line"><span class="cl">18 -0.863      b      4 -0.23 -0.687 -0.0619  0.0847
</span></span><span class="line"><span class="cl">19 -0.316      b      4 -0.23 -0.687 -0.3060  0.7541
</span></span><span class="line"><span class="cl">20 -1.607      b      4 -0.23 -0.687 -0.3805 -0.4993
</span></span><span class="line"><span class="cl">21 -0.809      b      5 -0.23 -0.446 -0.6947  0.2144
</span></span><span class="line"><span class="cl">22 -1.104      b      5 -0.23 -0.446 -0.2079 -0.3247
</span></span><span class="line"><span class="cl">23 -1.214      b      5 -0.23 -0.446 -1.2654  0.0946
</span></span><span class="line"><span class="cl">24 -0.487      b      5 -0.23 -0.446  2.1690 -0.8954
</span></span><span class="line"><span class="cl">25 -1.383      b      5 -0.23 -0.446  1.2080 -1.3108
</span></span><span class="line"><span class="cl">26  2.430      b      6 -0.23  1.224 -1.1231  1.9972
</span></span><span class="line"><span class="cl">27  1.393      b      6 -0.23  1.224 -0.4029  0.6007
</span></span><span class="line"><span class="cl">28 -0.491      b      6 -0.23  1.224 -0.4667 -1.2513
</span></span><span class="line"><span class="cl">29  0.773      b      6 -0.23  1.224  0.7800 -0.6112
</span></span><span class="line"><span class="cl">30 -0.233      b      6 -0.23  1.224 -0.0834 -1.1855
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">m2</span> <span class="o">&lt;-</span> <span class="nf">lmer</span><span class="p">(</span><span class="n">y</span> <span class="o">~</span> <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">sch.cl</span><span class="o">/</span><span class="n">tch.cl</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">summary</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zed" data-lang="zed"><span class="line"><span class="cl"><span class="n">Linear</span><span class="w"> </span><span class="n">mixed</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">REML</span><span class="p">.</span><span class="w"> </span><span class="n">t</span><span class="o">-</span><span class="n">tests</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">Satterthwaite</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">lmerModLmerTest</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Formula</span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="err">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sch</span><span class="p">.</span><span class="nn">cl/</span><span class="n">tch</span><span class="p">.</span><span class="n">cl</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">dat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">REML</span><span class="w"> </span><span class="n">criterion</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">convergence</span><span class="o">:</span><span class="w"> </span><span class="err">490</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Scaled</span><span class="w"> </span><span class="n">residuals</span><span class="o">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Min</span><span class="w">      </span><span class="err">1</span><span class="n">Q</span><span class="w">  </span><span class="n">Median</span><span class="w">      </span><span class="err">3</span><span class="n">Q</span><span class="w">     </span><span class="n">Max</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="err">2</span><span class="p">.</span><span class="err">5495</span><span class="w"> </span><span class="o">-</span><span class="err">0</span><span class="p">.</span><span class="err">5604</span><span class="w"> </span><span class="o">-</span><span class="err">0</span><span class="p">.</span><span class="err">0782</span><span class="w">  </span><span class="err">0</span><span class="p">.</span><span class="err">5296</span><span class="w">  </span><span class="err">2</span><span class="p">.</span><span class="err">0960</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Random</span><span class="w"> </span><span class="n">effects</span><span class="o">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Groups</span><span class="w">        </span><span class="n">Name</span><span class="w">        </span><span class="n">Variance</span><span class="w"> </span><span class="n">Std</span><span class="p">.</span><span class="n">Dev</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">tch</span><span class="p">.</span><span class="n">cl</span><span class="o">:</span><span class="n">sch</span><span class="p">.</span><span class="n">cl</span><span class="w"> </span><span class="p">(</span><span class="n">Intercept</span><span class="p">)</span><span class="w"> </span><span class="err">1</span><span class="p">.</span><span class="err">226</span><span class="w">    </span><span class="err">1</span><span class="p">.</span><span class="err">107</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">sch</span><span class="p">.</span><span class="n">cl</span><span class="w">        </span><span class="p">(</span><span class="n">Intercept</span><span class="p">)</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">420</span><span class="w">    </span><span class="err">0</span><span class="p">.</span><span class="err">648</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Residual</span><span class="w">                  </span><span class="err">0</span><span class="p">.</span><span class="err">981</span><span class="w">    </span><span class="err">0</span><span class="p">.</span><span class="err">991</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">obs</span><span class="o">:</span><span class="w"> </span><span class="err">150</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="o">:</span><span class="w">  </span><span class="n">tch</span><span class="p">.</span><span class="n">cl</span><span class="o">:</span><span class="n">sch</span><span class="p">.</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="err">30</span><span class="p">;</span><span class="w"> </span><span class="n">sch</span><span class="p">.</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="err">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Fixed</span><span class="w"> </span><span class="n">effects</span><span class="o">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Estimate</span><span class="w"> </span><span class="n">Std</span><span class="p">.</span><span class="w"> </span><span class="n">Error</span><span class="w">       </span><span class="n">df</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">Pr</span><span class="p">(</span><span class="o">&gt;|</span><span class="n">t</span><span class="o">|</span><span class="p">)</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="n">Intercept</span><span class="p">)</span><span class="w">   </span><span class="err">0</span><span class="p">.</span><span class="err">3759</span><span class="w">     </span><span class="err">0</span><span class="p">.</span><span class="err">2991</span><span class="w">   </span><span class="err">8</span><span class="p">.</span><span class="err">9956</span><span class="w">    </span><span class="err">1</span><span class="p">.</span><span class="err">26</span><span class="w">  </span><span class="err">0</span><span class="p">.</span><span class="err">24045</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">x1</span><span class="w">            </span><span class="err">0</span><span class="p">.</span><span class="err">3588</span><span class="w">     </span><span class="err">0</span><span class="p">.</span><span class="err">0922</span><span class="w"> </span><span class="err">124</span><span class="p">.</span><span class="err">7229</span><span class="w">    </span><span class="err">3</span><span class="p">.</span><span class="err">89</span><span class="w">  </span><span class="err">0</span><span class="p">.</span><span class="err">00016</span><span class="w"> </span><span class="o">***</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Signif</span><span class="p">.</span><span class="w"> </span><span class="n">codes</span><span class="o">:</span><span class="w">  </span><span class="err">0</span><span class="w"> </span><span class="err">&#39;</span><span class="o">***</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">001</span><span class="w"> </span><span class="err">&#39;</span><span class="o">**</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">01</span><span class="w"> </span><span class="err">&#39;</span><span class="o">*</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">05</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="err">&#39;</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">1</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="err">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Correlation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Fixed</span><span class="w"> </span><span class="n">Effects</span><span class="o">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">(</span><span class="n">Intr</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">x1</span><span class="w"> </span><span class="err">0</span><span class="p">.</span><span class="err">005</span><span class="w"> 
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Z</span> <span class="o">&lt;-</span> <span class="nf">getME</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="s">&#34;Z&#34;</span><span class="p">)</span> <span class="c1">#n x (sch + tch; just intercepts)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dim</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[1] 150  40
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">image</span><span class="p">(</span><span class="n">Z[1</span><span class="o">:</span><span class="m">30</span><span class="p">,</span><span class="n">]</span><span class="p">)</span> <span class="c1">#just showing the Z matrix for the first 30 obs</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="flex justify-center	">
    <div class="w-100" ><img alt="plot of chunk unnamed-chunk-8" srcset="
               /post/extracting-v-matrix/unnamed-chunk-8-1_hu_18d52d1fbd39d4d7.webp 400w,
               /post/extracting-v-matrix/unnamed-chunk-8-1_hu_eae07adfdeb3e827.webp 760w,
               /post/extracting-v-matrix/unnamed-chunk-8-1_hu_2d1b1a4d2138989d.webp 1200w"
               src="/post/extracting-v-matrix/unnamed-chunk-8-1_hu_18d52d1fbd39d4d7.webp"
               width="504"
               height="504"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>The $Z$ design matrix is different now since there are more than two levels. This needs to be multiplied by the $Gm$ matrix to follow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">G</span> <span class="o">&lt;-</span> <span class="nf">bdiag</span><span class="p">(</span><span class="nf">VarCorr</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span> <span class="c1">#how should G then be formed for the Gm?</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2 x 2 sparse Matrix of class &#34;dsCMatrix&#34;
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">[1,] 1.23 .   
</span></span><span class="line"><span class="cl">[2,] .    0.42
</span></span></code></pre></div><p>Intercept variance on upper left is for teachers and lower right is for schools. Constructing the matrix is relatively straightforward. Doing this manually.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">a1</span> <span class="o">&lt;-</span> <span class="nf">kronecker</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="m">30</span><span class="p">),</span> <span class="m">1.226473</span><span class="p">)</span> <span class="c1">#for teachers</span>
</span></span><span class="line"><span class="cl"><span class="n">a2</span> <span class="o">&lt;-</span> <span class="nf">kronecker</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="m">10</span><span class="p">),</span> <span class="m">.4201496</span><span class="p">)</span> <span class="c1">#for schools</span>
</span></span><span class="line"><span class="cl"><span class="n">Gm</span> <span class="o">&lt;-</span> <span class="nf">bdiag</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span> <span class="c1">#stacking as a diagonal matrix</span>
</span></span><span class="line"><span class="cl"><span class="nf">dim</span><span class="p">(</span><span class="n">Gm</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## [1] 40 40
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">image</span><span class="p">(</span><span class="n">Gm</span><span class="p">)</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="flex justify-center	">
    <div class="w-100" ><img alt="plot of chunk unnamed-chunk-10" srcset="
               /post/extracting-v-matrix/unnamed-chunk-10-1_hu_167a3343b26ed0d6.webp 400w,
               /post/extracting-v-matrix/unnamed-chunk-10-1_hu_e761401fc7920b4d.webp 760w,
               /post/extracting-v-matrix/unnamed-chunk-10-1_hu_dd7ca869956a71dc.webp 1200w"
               src="/post/extracting-v-matrix/unnamed-chunk-10-1_hu_167a3343b26ed0d6.webp"
               width="504"
               height="504"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Can then use this to create the $V$ matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">V</span> <span class="o">&lt;-</span> <span class="n">Z</span> <span class="o">%*%</span> <span class="n">Gm</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">+</span> <span class="nf">diag</span><span class="p">(</span><span class="nf">sigma</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="n">^2</span><span class="p">,</span> <span class="nf">nobs</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">&lt;-</span> <span class="n">m2</span><span class="o">@</span><span class="n">resp</span><span class="o">$</span><span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="nf">getFE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1">#compute our fixed effects</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 2 x 1 Matrix of class &#34;dgeMatrix&#34;
</span></span><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## (Intercept) 0.376
</span></span><span class="line"><span class="cl">## x1          0.359
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">fixef</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span> <span class="c1">#the same</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## (Intercept)          x1 
</span></span><span class="line"><span class="cl">##       0.376       0.359
</span></span></code></pre></div><p>If we use our <code>getV</code> function, this just works too which much less hassle!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">getFE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="nf">getV</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 2 x 1 Matrix of class &#34;dgeMatrix&#34;
</span></span><span class="line"><span class="cl">##              [,1]
</span></span><span class="line"><span class="cl">## (Intercept) 0.376
</span></span><span class="line"><span class="cl">## x1          0.359
</span></span></code></pre></div><h2 id="4-throw-in-random-slopes">4. Throw in random slopes</h2>
<p>The above will only work if the structure of $Z$ and $G$ are simple. If data are not sorted, that may not work.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">mlmRev</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">data</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">konly</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">star</span><span class="p">,</span> <span class="n">gr</span> <span class="o">==</span> <span class="s">&#39;K&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">sample_frac</span><span class="p">(</span><span class="m">.2</span><span class="p">)</span> <span class="c1">#just selecting a few</span>
</span></span><span class="line"><span class="cl"><span class="c1">#so the Z matrix can be seen</span>
</span></span><span class="line"><span class="cl"><span class="n">m3</span> <span class="o">&lt;-</span> <span class="nf">lmer</span><span class="p">(</span><span class="n">read</span> <span class="o">~</span> <span class="n">cltype</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">+</span> <span class="p">(</span><span class="n">sx</span><span class="o">|</span><span class="n">sch</span><span class="o">/</span><span class="n">tch</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">konly</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">model.matrix</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">&lt;-</span> <span class="n">m3</span><span class="o">@</span><span class="n">resp</span><span class="o">$</span><span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">Vm</span> <span class="o">&lt;-</span> <span class="nf">getV</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">getFE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Vm</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">4 x 1 Matrix of class &#34;dgeMatrix&#34;
</span></span><span class="line"><span class="cl">              [,1]
</span></span><span class="line"><span class="cl">(Intercept) 438.91
</span></span><span class="line"><span class="cl">cltypereg    -5.92
</span></span><span class="line"><span class="cl">cltypereg+A  -2.21
</span></span><span class="line"><span class="cl">sxF           2.05
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">fixef</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span> <span class="c1">#the same!</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(Intercept)   cltypereg cltypereg+A         sxF 
</span></span><span class="line"><span class="cl">     438.91       -5.92       -2.21        2.05 
</span></span></code></pre></div><p>Look at the $G$ matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">bdiag</span><span class="p">(</span><span class="nf">VarCorr</span><span class="p">(</span><span class="n">m3</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 4 x 4 sparse Matrix of class &#34;dsCMatrix&#34;
</span></span><span class="line"><span class="cl">##                                
</span></span><span class="line"><span class="cl">## [1,] 141.8 -10.118   .    .    
</span></span><span class="line"><span class="cl">## [2,] -10.1   0.722   .    .    
</span></span><span class="line"><span class="cl">## [3,]   .     .     153.9 -6.399
</span></span><span class="line"><span class="cl">## [4,]   .     .      -6.4  0.266
</span></span></code></pre></div><p>The <code>Z</code> matrix is a mess!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Z</span> <span class="o">&lt;-</span> <span class="nf">getME</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span> <span class="s">&#39;Z&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">image</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="flex justify-center	">
    <div class="w-100" ><img alt="plot of chunk unnamed-chunk-15" srcset="
               /post/extracting-v-matrix/unnamed-chunk-15-1_hu_b8a1e1573bfd75ba.webp 400w,
               /post/extracting-v-matrix/unnamed-chunk-15-1_hu_6a8a960aa886e209.webp 760w,
               /post/extracting-v-matrix/unnamed-chunk-15-1_hu_75cc487881a1151f.webp 1200w"
               src="/post/extracting-v-matrix/unnamed-chunk-15-1_hu_b8a1e1573bfd75ba.webp"
               width="504"
               height="504"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>You can compute the $V$ matrix per cluster but in this example, just wanted to get the overall matrix.</p>
<p>&ndash;END</p>

      </div>

      
  <time class="mt-12 mb-8 block text-xs text-gray-500 ltr:text-right rtl:text-left dark:text-gray-400" datetime="2021-06-18T00:00:00.000Z">
    <span>Last updated on</span>
    Jun 18, 2021</time>

      <div class="container mx-auto prose prose-slate lg:prose-xl dark:prose-invert mt-5">
        
        
  <div id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="999ce0c5-9bf3-489b-a340-698616f5b80a"
  data-page-id="http://localhost:1313/post/extracting-v-matrix/"
  data-page-url="http://localhost:1313/post/extracting-v-matrix/"
  data-page-title="Extracting the V matrix for MLMs"
  data-theme="auto"
></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>




      </div>

    </main>
  </article>
</div>

    </div>
    <div class="page-footer">
      <footer class="container mx-auto flex flex-col justify-items-center text-sm leading-6 mt-24 mb-4 text-slate-700 dark:text-slate-200">

  












  
  
  
  
  














  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by text-center">
    © 2025 Grumblesquasher. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">CC BY NC SA 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-sa fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by text-center">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> — the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>

</footer>

    </div>

    
    











  </body>
</html>
